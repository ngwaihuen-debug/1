<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±äº¬ V16 - è‡ªå‹•é ç®—èˆ‡å¯¦æ™‚å°èˆª</title>
    <style>
        :root { --primary: #d32f2f; --sub: #1d3557; --bg: #f4f7f9; --google-blue: #4285F4; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        
        .header { background: var(--sub); color: white; padding: 10px; text-align: center; flex-shrink: 0; }
        .main-container { display: flex; flex: 1; overflow: hidden; }
        
        /* å·¦å´ï¼šè¡Œç¨‹æ™‚é–“è»¸ */
        .itinerary-section { flex: 6; overflow-y: auto; padding: 10px; border-right: 2px solid #ddd; }
        .day-card { background: white; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .day-title { background: var(--primary); color: white; padding: 10px; font-weight: bold; position: sticky; top: 0; z-index: 10; }
        
        .slot { margin-left: 20px; border-left: 2px solid #eee; padding: 0 0 20px 20px; position: relative; }
        .time-tag { background: #eee; padding: 2px 8px; border-radius: 10px; font-size: 11px; font-weight: bold; position: absolute; left: -55px; width: 40px; text-align: center; }
        .place-input { width: 95%; font-weight: bold; border: 1px solid #ccc; padding: 8px; border-radius: 4px; background: #fffdf0; }
        
        /* æ•¸æ“šèˆ‡æŒ‰éˆ• */
        .data-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 4px; margin: 10px 0; }
        .data-box { border: 1px solid #eee; border-radius: 4px; padding: 4px; text-align: center; font-size: 9px; }
        .data-box input { width: 100%; border: none; text-align: center; font-weight: bold; font-size: 13px; color: var(--primary); background: transparent; }
        
        .btn-row { display: flex; gap: 5px; }
        .btn { flex: 1; padding: 10px; border: none; border-radius: 4px; font-size: 12px; font-weight: bold; cursor: pointer; color: white; }
        .btn-auto { background: #ff9800; }
        .btn-nav { background: var(--google-blue); }

        /* å³å´ï¼šGoogle åœ°åœ–å€ */
        .map-section { flex: 4; display: flex; flex-direction: column; background: #fff; }
        .map-header { padding: 15px; background: #f8f9fa; border-bottom: 1px solid #ddd; }
        .map-iframe { flex: 1; border: none; width: 100%; }
        .nav-link-box { padding: 15px; background: #e8f0fe; text-align: center; border-top: 1px solid #ddd; }
        .nav-link-box a { color: var(--google-blue); font-weight: bold; text-decoration: none; font-size: 14px; }

        .footer { background: white; padding: 15px; border-top: 1px solid #ddd; text-align: center; }
        .save-btn { background: #28a745; color: white; border: none; padding: 12px 60px; border-radius: 25px; font-weight: bold; cursor: pointer; font-size: 16px; }
    </style>
</head>
<body>

<div class="header"><strong>TOKYO TRAVEL V16</strong> | è‡ªå‹•é ç®— + å¯¦æ™‚å°èˆªç³»çµ±</div>

<div class="main-container">
    <div class="itinerary-section" id="itin-list"></div>

    <div class="map-section">
        <div class="map-header">
            <h4 style="margin:0; color:var(--google-blue);">ğŸ—ºï¸ Google Maps é è¦½</h4>
            <small id="current-dest-text">è«‹é»æ“Šå·¦å´ã€Œå¯¦æ™‚å°èˆªã€</small>
        </div>
        <iframe id="map-frame" class="map-iframe" src="https://www.google.com/search?q=Tokyo+Tourist+Spots&igu=1"></iframe>
        <div class="nav-link-box">
            <a id="external-nav-link" href="#" target="_blank">ğŸ”— é»æ­¤é–‹å•Ÿå®Œæ•´ Google Maps å°èˆªè·¯ç·š</a>
        </div>
    </div>
</div>

<div class="footer"><button class="save-btn" onclick="saveData()">ğŸ’¾ å„²å­˜æ‰€æœ‰æ ¡å°æ•¸æ“š</button></div>

<script>
    const HOTEL = "Asakusa View Hotel Annex Rokku";
    
    // é è¨­é ç®—æ•¸æ“šåº«
    const TRAFFIC_DB = [
        { key: "æ©Ÿå ´", sf: 1310, st: 65, wt: 15, tf: 28000, tt: 75 },
        { key: "è¿ªå£«å°¼", sf: 850, st: 55, wt: 12, tf: 9000, tt: 45 },
        { key: "æ–°å®¿", sf: 350, st: 40, wt: 10, tf: 7000, tt: 35 },
        { key: "æ¾€è°·", sf: 350, st: 45, wt: 12, tf: 7500, tt: 40 },
        { key: "ä¸Šé‡", sf: 180, st: 15, wt: 10, tf: 1800, tt: 12 },
        { key: "éŠ€åº§", sf: 210, st: 20, wt: 8, tf: 3500, tt: 18 },
        { key: "æ·ºè‰", sf: 0, st: 0, wt: 9, tf: 600, tt: 5 },
        { key: "æ™´ç©ºå¡”", sf: 180, st: 10, wt: 15, tf: 1400, tt: 10 }
    ];

    function getSlotHTML(time = "09:00") {
        return `
        <div class="slot">
            <div class="time-tag">${time}</div>
            <input type="text" class="place-input" value="${HOTEL} -> " placeholder="è«‹è¼¸å…¥ç›®çš„åœ°">
            <div class="data-grid">
                <div class="data-box"><label>ğŸš‡(å††)</label><input type="number" class="s-f"></div>
                <div class="data-box"><label>â±ï¸åœ°éµ(åˆ†)</label><input type="number" class="s-t" onchange="recalcAll()"></div>
                <div class="data-box" style="background:#fff9c4;"><label>ğŸš¶æ­¥è¡Œ(åˆ†)</label><input type="number" class="w-t" onchange="recalcAll()"></div>
                <div class="data-box"><label>ğŸš•(å††)</label><input type="number" class="t-f"></div>
                <div class="data-box"><label>â±ï¸çš„å£«(åˆ†)</label><input type="number" class="t-t"></div>
                <div class="data-box" style="background:#e8f5e9;"><label>ğŸ•’åœç•™(åˆ†)</label><input type="number" class="stay-t" value="60" onchange="recalcAll()"></div>
            </div>
            <div class="btn-row">
                <button class="btn btn-auto" onclick="autoCal(this)">ğŸš€ è‡ªå‹•è¨ˆç®—éŒ¢èˆ‡æ™‚é–“</button>
                <button class="btn btn-nav" onclick="showNav(this)">ğŸ—ºï¸ å¯¦æ™‚å°èˆª (æŸ¥çœ‹åœ°åœ–)</button>
            </div>
        </div>`;
    }

    // æŒ‰éˆ•åŠŸèƒ½ 1ï¼šè‡ªå‹•è¨ˆç®—
    window.autoCal = function(btn) {
        const slot = btn.closest('.slot');
        const text = slot.querySelector('.place-input').value;
        let found = TRAFFIC_DB.find(item => text.includes(item.key));
        
        if (found) {
            slot.querySelector('.s-f').value = found.sf;
            slot.querySelector('.s-t').value = found.st;
            slot.querySelector('.w-t').value = found.wt;
            slot.querySelector('.t-f').value = found.tf;
            slot.querySelector('.t-t').value = found.tt;
        } else {
            slot.querySelector('.s-f').value = 250;
            slot.querySelector('.s-t').value = 35;
            slot.querySelector('.w-t').value = 10;
        }
        recalcAll();
        btn.innerText = "âœ… å·²æ›´æ–°æ•¸æ“š";
        setTimeout(() => btn.innerText = "ğŸš€ è‡ªå‹•è¨ˆç®—éŒ¢èˆ‡æ™‚é–“", 1500);
    }

    // æŒ‰éˆ•åŠŸèƒ½ 2ï¼šå¯¦æ™‚å°èˆª
    window.showNav = function(btn) {
        const val = btn.closest('.slot').querySelector('.place-input').value;
        const dest = val.split("->")[1] ? val.split("->")[1].trim() : val;
        
        document.getElementById('current-dest-text').innerText = "ç›®çš„åœ°ï¼š" + dest;
        // æ›´æ–°å³å´é è¦½
        document.getElementById('map-frame').src = `https://www.google.com/search?q=${encodeURIComponent(dest + " Tokyo Address")}&igu=1`;
        // æ›´æ–°å¯¦æ™‚å°èˆªé€£çµ
        const navUrl = `https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(HOTEL)}&destination=${encodeURIComponent(dest)}&travelmode=transit`;
        document.getElementById('external-nav-link').href = navUrl;
    }

    // æ™‚é–“è»¸é‡æ–°è¨ˆç®—
    window.recalcAll = function() {
        document.querySelectorAll('.day-card').forEach(card => {
            let baseTime = new Date();
            baseTime.setHours(9, 0, 0);
            card.querySelectorAll('.slot').forEach(slot => {
                slot.querySelector('.time-tag').innerText = baseTime.getHours().toString().padStart(2, '0') + ":" + baseTime.getMinutes().toString().padStart(2, '0');
                let dur = (parseInt(slot.querySelector('.s-t').value) || 0) + (parseInt(slot.querySelector('.w-t').value) || 0) + (parseInt(slot.querySelector('.stay-t').value) || 0);
                baseTime.setMinutes(baseTime.getMinutes() + dur);
            });
        });
    }

    window.onload = () => {
        const saved = localStorage.getItem('tokyo_v16_data');
        if (saved) document.getElementById('itin-list').innerHTML = saved;
        else {
            for(let i=1; i<=6; i++) {
                document.getElementById('itin-list').insertAdjacentHTML('beforeend', `
                    <div class="day-card">
                        <div class="day-title">1æœˆ${17+i}æ—¥ (Day ${i})</div>
                        <div class="timeline" id="day-${i}-tl">${getSlotHTML()}</div>
                        <button style="width:100%; border:none; background:#eee; padding:10px;" onclick="addSlot(${i})">+ å¢åŠ æ™‚é–“è»¸è¡Œç¨‹</button>
                    </div>
                `);
            }
        }
    };

    window.addSlot = (i) => {
        document.getElementById(`day-${i}-tl`).insertAdjacentHTML('beforeend', getSlotHTML());
        recalcAll();
    };

    window.saveData = () => {
        document.querySelectorAll('input').forEach(i => i.setAttribute('value', i.value));
        localStorage.setItem('tokyo_v16_data', document.getElementById('itin-list').innerHTML);
        alert("å­˜æª”æˆåŠŸï¼");
    };
</script>
</body>
</html>
